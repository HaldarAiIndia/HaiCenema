:root {
    --bg-primary: #17181a;
    --bg-secondary: #202225;
    --bg-tertiary: #2c2f33;
    --bg-code: #101214;
    --bg-hover: #35383c;
    --text-primary: #f0f2f5;
    --text-secondary: #a8b3cf;
    --text-active: #82aaff;
    --border-color: #3a3d42;
    --error-color: #ff8a80;
    --sidebar-width: 260px;
    --font-family: 'Inter', sans-serif;
    --font-family-code: 'Roboto Mono', monospace;
}

/* --- Base & Reset --- */
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html, body { height: 100%; overflow: hidden; background-color: var(--bg-primary); color: var(--text-primary); font-family: var(--font-family); font-size: 16px; }
button, a { background: none; border: none; cursor: pointer; color: inherit; text-decoration: none; font-family: inherit; }
.material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24; font-size: 20px; color: var(--text-secondary); transition: color 0.2s; user-select: none; }

/* --- Accessibility --- */
.visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
*:focus-visible { outline: 2px solid var(--text-active); outline-offset: 2px; border-radius: 4px; }

/* --- Main Layout --- */
.app-container { display: flex; width: 100%; height: 100%; }
.main-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; }
.main-header { display: flex; align-items: center; padding: 12px 24px; background-color: rgba(23, 24, 26, 0.7); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border-color); flex-shrink: 0; position: sticky; top: 0; z-index: 100; }
.header-title { font-size: 1.1rem; font-weight: 600; margin: 0 auto; }
.icon-button { padding: 8px; border-radius: 50%; display: flex; transition: background-color 0.2s; }
.icon-button:hover { background-color: var(--bg-hover); }
.content-area { flex-grow: 1; overflow: hidden; position: relative; }

/* --- Sidebar --- */
#left-sidebar { position: fixed; top: 0; left: 0; height: 100%; width: var(--sidebar-width); max-width: 85%; background-color: var(--bg-secondary); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; z-index: 1001; transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
body.left-sidebar-open #left-sidebar { transform: translateX(0); }
.sidebar-content { padding: 16px; display: flex; flex-direction: column; flex-grow: 1; overflow-y: auto; }
.sidebar-header { font-size: 1.75rem; font-weight: 700; padding: 12px; margin-bottom: 24px; }
.sidebar-nav a, .sidebar-nav button { font-size: 1em; display: flex; align-items: center; gap: 16px; padding: 12px; border-radius: 8px; font-weight: 500; transition: background-color 0.2s, color 0.2s, opacity 0.2s; color: var(--text-secondary); text-align: left; width: 100%; }
.sidebar-nav a:hover, .sidebar-nav button:hover { background-color: var(--bg-hover); color: var(--text-primary); }
.sidebar-nav a.active { background-color: var(--bg-tertiary); color: var(--text-primary); }
.sidebar-nav .material-symbols-outlined { color: var(--text-secondary); }
.sidebar-nav a:hover .material-symbols-outlined, .sidebar-nav a.active .material-symbols-outlined, .sidebar-nav button:hover .material-symbols-outlined { color: var(--text-primary); }
.sidebar-footer { margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border-color); }

/* --- Screen Layout --- */
.screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; }
.screen.active { display: block; }
.content-wrapper { max-width: 1400px; width: 100%; margin: 0 auto; padding: 24px; }

/* --- Modal Component --- */
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 2000; }
.modal-overlay.visible { opacity: 1; visibility: visible; }
.modal-content { background-color: var(--bg-secondary); padding: 24px; border-radius: 12px; border: 1px solid var(--border-color); width: 90%; max-width: 500px; transform: scale(0.95); transition: transform 0.3s; max-height: 90vh; display: flex; flex-direction: column; }
.modal-overlay.visible .modal-content { transform: scale(1); }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-shrink: 0; }
.modal-header h2 { font-size: 1.25rem; font-weight: 600; }
.modal-body { overflow-y: auto; }

/* --- Form Group --- */
.form-group { margin-bottom: 20px; }
.form-group label { display: block; font-size: 0.9rem; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }
.form-group input, .form-group select { width: 100%; background-color: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; padding: 12px; font-size: 1rem; color: var(--text-primary); outline: none; transition: border-color 0.2s; -webkit-appearance: none; -moz-appearance: none; appearance: none; }
.form-group select.input { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23a8b3cf' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
.form-group input:focus, .form-group select:focus { border-color: var(--text-active); }
.profile-actions { display: flex; justify-content: flex-end; gap: 12px; }
.btn { padding: 10px 20px; font-weight: 600; border-radius: 8px; transition: background-color 0.2s, color 0.2s, opacity 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
.btn-primary { background-color: var(--text-active); color: var(--bg-primary); }
.btn-primary:hover:not(:disabled) { opacity: 0.9; }
.btn-secondary { background: none; border: 1px solid var(--border-color); color: var(--text-primary); }
.btn-secondary:hover:not(:disabled) { background-color: var(--bg-hover); }
.btn:disabled { opacity: 0.6; cursor: wait; }

/* --- Responsive & Overlay --- */
.overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 1000; }
body.left-sidebar-open .overlay { opacity: 1; visibility: visible; }
@media (min-width: 1024px) {
    #left-sidebar { position: static; transform: none; border-right: 1px solid var(--border-color); }
    .icon-button#menu-toggle { display: none; }
    .main-header .header-title { margin-left: 0; }
    .overlay { display: none; }
}

/* --- APP-SPECIFIC STYLES --- */
.hidden { display: none !important; }

/* FAB */
#fab { position: fixed; bottom: 24px; right: 24px; z-index: 500; width: 56px; height: 56px; padding: 0; border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
#fab .material-symbols-outlined { font-size: 28px; }

/* Media Grid */
.media-grid {
    display: grid;
    /* UPDATED: Reduced the minimum card size from 180px to 150px */
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    /* UPDATED: Reduced the gap for a tighter layout */
    gap: 12px;
}
.media-card { background-color: var(--bg-secondary); border-radius: 8px; overflow: hidden; position: relative; border: 1px solid var(--border-color); transition: transform 0.2s, box-shadow 0.2s; aspect-ratio: 2 / 3; }
.media-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
.media-card img { width: 100%; height: 100%; object-fit: cover; }
.media-card-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 50%); opacity: 0; transition: opacity 0.2s; display: flex; flex-direction: column; justify-content: flex-end; padding: 12px; }
.media-card:hover .media-card-overlay { opacity: 1; }
.media-card-title {
    font-weight: 600;
    /* UPDATED: Reduced font size to better fit smaller cards */
    font-size: 0.9rem;
    color: var(--text-primary);
    margin-bottom: 8px;
}
.media-card-actions { display: flex; gap: 8px; }
.media-card-actions .icon-button { background-color: rgba(32, 34, 37, 0.8); backdrop-filter: blur(5px); }
.media-card-actions .icon-button:hover { background-color: var(--bg-hover); }

/* Switch Toggle */
.form-group-inline { display: flex; justify-content: space-between; align-items: center; }
.switch { position: relative; display: inline-block; width: 50px; height: 28px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--bg-tertiary); transition: .4s; border-radius: 28px; }
.slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: var(--text-active); }
input:checked + .slider:before { transform: translateX(22px); }

/* Episode Form */
#episodes-container { display: flex; flex-direction: column; gap: 16px; margin-top: 16px; }
.episode-input-group { background-color: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; padding: 16px; position: relative; }
.episode-input-group h4 { font-weight: 600; margin-bottom: 12px; }
.episode-input-group .form-group { margin-bottom: 12px; }
.episode-input-group .form-group:last-child { margin-bottom: 0; }
.episode-input-group .remove-episode-btn { position: absolute; top: 8px; right: 8px; }

/* Banner List */
#banner-list { display: flex; flex-direction: column; gap: 8px; }
.banner-item { display: flex; align-items: center; justify-content: space-between; background-color: var(--bg-tertiary); padding: 8px 12px; border-radius: 6px; }
.banner-item span { text-overflow: ellipsis; overflow: hidden; white-space: nowrap; padding-right: 16px; font-size: 0.9rem; }
.banner-item .actions { display: flex; gap: 4px; }

/* Permissions List */
#permissions-list { display: flex; flex-direction: column; gap: 8px; }
.permission-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; border-radius: 6px; }
.permission-item:nth-child(odd) { background-color: var(--bg-tertiary); }

/* Input field prompt */
.prompt-input-wrapper { position: relative; width: 100%; max-width: 820px; margin: 0 auto; display: flex; align-items: flex-end; gap: 12px; background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 8px 12px; transition: border-color 0.2s; }
.prompt-input-wrapper:focus-within { border-color: var(--text-active); }
.prompt-input { width: 100%; background: transparent; border: none; color: var(--text-primary); outline: none; font-size: 1rem; line-height: 1.6; resize: none; max-height: 200px; }
.send-button { background-color: var(--bg-tertiary); width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; align-self: flex-end; transition: all 0.2s ease; }
.send-button.active { background-color: var(--text-active); }
.send-button.active .material-symbols-outlined { color: var(--bg-primary); }```

---

### **script.js**

*(No changes were needed for this file, but it is included for completeness.)*

```javascript
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, setDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// IMPORTANT: Replace with your actual Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDwH5hg4QRYcTzyPd492L9g2xG3QPvCWMY",
  authDomain: "haicenema.firebaseapp.com",
  databaseURL: "https://haicenema-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "haicenema",
  storageBucket: "haicenema.firebasestorage.app",
  messagingSenderId: "825485404342",
  appId: "1:825485404342:web:c488be2082a9b30c3cde17",
  measurementId: "G-9YG52515FX"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentSection = 'movies';
let episodeCounter = 0;
let unsubscribers = {};

const ui = {
    body: document.body,
    menuToggle: document.getElementById('menu-toggle'),
    overlay: document.querySelector('.overlay'),
    navLinks: document.querySelectorAll('.nav-link'),
    headerTitle: document.getElementById('header-title'),
    screens: document.querySelectorAll('.screen'),
    contentAreas: {
        movies: document.getElementById('movies-content-area'),
        series: document.getElementById('series-content-area'),
        livetv: document.getElementById('livetv-content-area'),
    },
    fab: document.getElementById('fab'),
    // Modals
    formModalOverlay: document.getElementById('form-modal-overlay'),
    permissionsModalOverlay: document.getElementById('permissions-modal-overlay'),
    bannerModalOverlay: document.getElementById('banner-modal-overlay'),
    confirmDialogOverlay: document.getElementById('confirm-dialog-overlay'),
    // Form Modal
    modalTitle: document.getElementById('modal-title'),
    dataForm: document.getElementById('data-form'),
    editId: document.getElementById('edit-id'),
    nameInput: document.getElementById('name'),
    imageUrlInput: document.getElementById('image-url'),
    isPublicInput: document.getElementById('is-public'),
    movieFields: document.getElementById('movie-fields'),
    movieUrlInput: document.getElementById('movie-url'),
    catalogueInput: document.getElementById('catalogue'),
    seriesFields: document.getElementById('series-fields'),
    seriesNumberInput: document.getElementById('series-number'),
    episodesContainer: document.getElementById('episodes-container'),
    addEpisodeBtn: document.getElementById('add-episode-btn'),
    livetvFields: document.getElementById('livetv-fields'),
    livetvUrlInput: document.getElementById('livetv-url'),
    cancelBtn: document.getElementById('cancel-btn'),
    formCloseBtn: document.getElementById('form-close-btn'),
    // Permissions Modal
    permissionsBtn: document.getElementById('permissions-btn'),
    permissionsList: document.getElementById('permissions-list'),
    closePermissionsBtn: document.getElementById('close-permissions-btn'),
    // Banner Modal
    bannerBtn: document.getElementById('banner-btn'),
    bannerModal: document.getElementById('banner-modal'),
    bannerForm: document.getElementById('banner-form'),
    bannerUrlInput: document.getElementById('banner-url'),
    bannerEditId: document.getElementById('banner-edit-id'),
    bannerList: document.getElementById('banner-list'),
    closeBannerBtn: document.getElementById('close-banner-btn'),
    // Confirm Dialog
    confirmTitle: document.getElementById('confirm-title'),
    confirmMessage: document.getElementById('confirm-message'),
    confirmOk: document.getElementById('confirm-ok'),
    confirmCancel: document.getElementById('confirm-cancel'),
};

const showConfirmation = (title, message) => {
    ui.confirmTitle.textContent = title;
    ui.confirmMessage.textContent = message;
    ui.confirmDialogOverlay.classList.add('visible');
    return new Promise((resolve) => {
        ui.confirmOk.onclick = () => {
            ui.confirmDialogOverlay.classList.remove('visible');
            resolve(true);
        };
        ui.confirmCancel.onclick = () => {
            ui.confirmDialogOverlay.classList.remove('visible');
            resolve(false);
        };
    });
};

function addEpisodeInput(episode = { url: '', imageUrl: '' }) {
    episodeCounter++;
    const episodeDiv = document.createElement('div');
    episodeDiv.className = 'episode-input-group';
    episodeDiv.innerHTML = `
        <h4>Episode ${episodeCounter}</h4>
        <button type="button" class="icon-button remove-episode-btn"><span class="material-symbols-outlined">close</span></button>
        <div class="form-group">
            <label>Episode URL</label>
            <input type="url" placeholder="https://..." value="${episode.url}" class="episode-url" required>
        </div>
        <div class="form-group">
            <label>Episode Image URL</label>
            <input type="url" placeholder="https://..." value="${episode.imageUrl}" class="episode-image-url" required>
        </div>
    `;
    ui.episodesContainer.appendChild(episodeDiv);
    episodeDiv.querySelector('.remove-episode-btn').addEventListener('click', () => episodeDiv.remove());
}

function resetForm() {
    ui.dataForm.reset();
    ui.editId.value = '';
    ui.episodesContainer.innerHTML = '';
    episodeCounter = 0;
    ui.movieFields.classList.add('hidden');
    ui.seriesFields.classList.add('hidden');
    ui.livetvFields.classList.add('hidden');
}

function showModal(type, data = null) {
    resetForm();
    if (type === 'movies') {
        ui.modalTitle.textContent = data ? 'Edit Movie' : 'Add Movie';
        ui.movieFields.classList.remove('hidden');
        if (data) {
            ui.editId.value = data.id; ui.nameInput.value = data.name; ui.imageUrlInput.value = data.imageUrl;
            ui.movieUrlInput.value = data.movieUrl; ui.catalogueInput.value = data.catalogue; ui.isPublicInput.checked = data.isPublic;
        }
    } else if (type === 'series') {
        ui.modalTitle.textContent = data ? 'Edit Series' : 'Add Series';
        ui.seriesFields.classList.remove('hidden');
        if (data) {
            ui.editId.value = data.id; ui.nameInput.value = data.name; ui.imageUrlInput.value = data.imageUrl;
            ui.seriesNumberInput.value = data.seriesNumber; ui.isPublicInput.checked = data.isPublic;
            data.episodes.forEach(ep => addEpisodeInput(ep));
        } else {
             addEpisodeInput();
        }
    } else if (type === 'livetv') {
        ui.modalTitle.textContent = data ? 'Edit Live TV' : 'Add Live TV';
        ui.livetvFields.classList.remove('hidden');
        if (data) {
            ui.editId.value = data.id; ui.nameInput.value = data.name; ui.imageUrlInput.value = data.imageUrl;
            ui.livetvUrlInput.value = data.liveTvUrl; ui.isPublicInput.checked = data.isPublic;
        }
    }
    ui.formModalOverlay.classList.add('visible');
}

function hideAllModals() {
    document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('visible'));
}

async function saveData(e) {
    e.preventDefault();
    const id = ui.editId.value;
    const commonData = {
        name: ui.nameInput.value, imageUrl: ui.imageUrlInput.value,
        isPublic: ui.isPublicInput.checked,
    };

    let data;
    if (currentSection === 'movies') {
        data = { ...commonData, movieUrl: ui.movieUrlInput.value, catalogue: ui.catalogueInput.value };
    } else if (currentSection === 'series') {
        data = { ...commonData, seriesNumber: parseInt(ui.seriesNumberInput.value),
            episodes: Array.from(ui.episodesContainer.children).map(div => ({
                url: div.querySelector('.episode-url').value, imageUrl: div.querySelector('.episode-image-url').value,
            }))
        };
    } else if (currentSection === 'livetv') {
        data = { ...commonData, liveTvUrl: ui.livetvUrlInput.value };
    }

    try {
        if (id) {
            await setDoc(doc(db, currentSection, id), data, { merge: true });
        } else {
            await addDoc(collection(db, currentSection), { ...data, createdAt: new Date() });
        }
        hideAllModals();
    } catch (error) { console.error("Error saving document: ", error); }
}

async function deleteData(id) {
    const confirmed = await showConfirmation('Delete Content', 'This action cannot be undone. Are you sure?');
    if (confirmed) {
        try { await deleteDoc(doc(db, currentSection, id)); } 
        catch (error) { console.error("Error removing document: ", error); }
    }
}

function renderContent(section, data) {
    const contentArea = ui.contentAreas[section];
    if (!contentArea) return;
    
    contentArea.innerHTML = `<div class="media-grid">${data.map(item => `
        <div class="media-card">
            <img src="${item.imageUrl}" alt="${item.name}">
            <div class="media-card-overlay">
                <h3 class="media-card-title">${item.name}</h3>
                <div class="media-card-actions">
                    <button class="icon-button edit-btn" data-id="${item.id}"><span class="material-symbols-outlined">edit</span></button>
                    <button class="icon-button delete-btn" data-id="${item.id}"><span class="material-symbols-outlined">delete</span></button>
                </div>
            </div>
        </div>
    `).join('')}</div>`;

    contentArea.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const docToEdit = data.find(d => d.id === btn.dataset.id);
            showModal(section, docToEdit);
        });
    });
    contentArea.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => deleteData(btn.dataset.id));
    });
}

function setupRealtimeListener(section) {
    if (unsubscribers[section]) unsubscribers[section]();
    
    const q = collection(db, section);
    unsubscribers[section] = onSnapshot(q, (querySnapshot) => {
        const data = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        const sortedData = data.sort((a,b) => (b.createdAt?.toDate() || 0) - (a.createdAt?.toDate() || 0));
        renderContent(section, sortedData);
    });
}

function switchSection(section) {
    currentSection = section;
    ui.screens.forEach(s => s.classList.toggle('active', s.id === `${section}-screen`));
    ui.navLinks.forEach(l => l.classList.toggle('active', l.dataset.section === section));
    const titles = {movies: "Movies", series: "Series", livetv: "Live TV"};
    ui.headerTitle.textContent = titles[section];
    setupRealtimeListener(section);
}

// Sidebar Logic
function toggleSidebar(forceClose = false) {
    if (forceClose) ui.body.classList.remove('left-sidebar-open');
    else ui.body.classList.toggle('left-sidebar-open');
}

// Permissions Modal Logic
function showPermissionsModal() {
    toggleSidebar(true);
    ui.permissionsModalOverlay.classList.add('visible');
    
    if (unsubscribers.permissions) unsubscribers.permissions();
    const q = collection(db, 'livetv');
    unsubscribers.permissions = onSnapshot(q, (querySnapshot) => {
        const channels = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        ui.permissionsList.innerHTML = channels.map(channel => `
            <div class="permission-item">
                <span>${channel.name}</span>
                <label class="switch">
                    <input type="checkbox" class="channel-toggle" data-id="${channel.id}" ${channel.isPublic ? 'checked' : ''}>
                    <span class="slider"></span>
                </label>
            </div>
        `).join('');
        
        ui.permissionsList.querySelectorAll('.channel-toggle').forEach(toggle => {
            toggle.addEventListener('change', async (e) => {
                 await updateDoc(doc(db, 'livetv', e.target.dataset.id), { isPublic: e.target.checked });
            });
        });
    });
}

// Banner Modal Logic
function showBannerModal() {
    toggleSidebar(true);
    ui.bannerModalOverlay.classList.add('visible');

    if (unsubscribers.banners) unsubscribers.banners();
    const q = collection(db, 'banners');
    unsubscribers.banners = onSnapshot(q, (querySnapshot) => {
        const banners = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        ui.bannerList.innerHTML = banners.map(banner => `
            <div class="banner-item">
                <span>${banner.url}</span>
                <div class="actions">
                    <button class="icon-button edit-banner-btn" data-id="${banner.id}" data-url="${banner.url}"><span class="material-symbols-outlined" style="font-size:18px;">edit</span></button>
                    <button class="icon-button delete-banner-btn" data-id="${banner.id}"><span class="material-symbols-outlined" style="font-size:18px;">delete</span></button>
                </div>
            </div>
        `).join('');
        
        ui.bannerList.querySelectorAll('.edit-banner-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                ui.bannerUrlInput.value = btn.dataset.url;
                ui.bannerEditId.value = btn.dataset.id;
                ui.bannerUrlInput.focus();
            });
        });
         ui.bannerList.querySelectorAll('.delete-banner-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                if (await showConfirmation('Delete Banner', 'Are you sure?')) {
                   await deleteDoc(doc(db, 'banners', btn.dataset.id));
                }
            });
        });
    });
}

ui.bannerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const url = ui.bannerUrlInput.value;
    const id = ui.bannerEditId.value;
    if (!url) return;

    try {
        const data = id ? { url, updatedAt: new Date() } : { url, createdAt: new Date() };
        const docRef = id ? doc(db, 'banners', id) : collection(db, 'banners');
        id ? await setDoc(docRef, data, { merge: true }) : await addDoc(docRef, data);
        
        ui.bannerForm.reset();
        ui.bannerEditId.value = '';
    } catch(err) { console.error("Error saving banner:", err) }
});

// Initial Event Listeners
ui.menuToggle.addEventListener('click', () => toggleSidebar());
ui.overlay.addEventListener('click', () => toggleSidebar(true));
ui.fab.addEventListener('click', () => showModal(currentSection));
ui.cancelBtn.addEventListener('click', hideAllModals);
ui.formCloseBtn.addEventListener('click', hideAllModals);
ui.dataForm.addEventListener('submit', saveData);
ui.addEpisodeBtn.addEventListener('click', () => addEpisodeInput());

ui.navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();
        switchSection(link.dataset.section);
        toggleSidebar(true);
    });
});

ui.permissionsBtn.addEventListener('click', showPermissionsModal);
ui.closePermissionsBtn.addEventListener('click', hideAllModals);

ui.bannerBtn.addEventListener('click', showBannerModal);
ui.closeBannerBtn.addEventListener('click', hideAllModals);

// Initial Load
switchSection('movies');
